<div class="container-fluid mt-2 border-radius-3 p-5">
  <h1 class="text-center text-uppercase">Parking lots</h1>
  <div class="row">
    {% for lot in context['lots'] %}
    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title text-center">Parking Lot {{ lot.id }}</h5>
          <div class="text-center mb-2">
            <button class="btn btn-primary" data-bs-toggle="modal"
              data-bs-target="#EditLotModal{{ lot.id }}">Edit</button>
            <form action="{{ url_for('delete_parking_lot', lot_id=lot.id) }}" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure?')">Delete</button>
            </form>
          </div>
          <p class="card-text text-center ">Occupied Spots: <mark>{{ lot.occupied_spots() }}/{{ lot.max_spots }}</mark></p>
          <div class="container text-center">
            {% for spot in lot.spots %}
            {% if spot.status == 'A' %}
            <button data-bs-toggle="modal" data-bs-target="#ViewDeleteSpotModal{{spot.id}}"
              class="btn btn-success m-1">{{ spot.status }}</button>
            {% elif spot.status == 'B' %}
            <!-- Occupied spot button (O) -->
            <button data-bs-toggle="modal" data-bs-target="#ViewDeleteSpotModal{{spot.id}}"
              class="btn btn-warning m-1">{{ spot.status }}</button>
            {% else %}
            <button data-bs-toggle="modal" data-bs-target="#ViewDeleteSpotModal{{spot.id}}"
              class="btn btn-danger m-1">{{ spot.status }}</button>
            {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Lot Modal for this lot -->
    <div class="modal fade" id="EditLotModal{{ lot.id }}" tabindex="-1" aria-labelledby="EditLotModalLabel{{ lot.id }}"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="POST" action="{{ url_for('edit_parking_lot', lot_id=lot.id) }}">
            <div class="modal-header">
              <h5 class="modal-title" id="EditLotModalLabel{{ lot.id }}">Edit Parking Lot</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="lotName{{ lot.id }}" class="form-label">Prime Location Name</label>
                <input type="text" class="form-control" id="lotName{{ lot.id }}" name="lotname" value="{{ lot.name }}"
                  required>
              </div>
              <div class="mb-3">
                <label for="location{{ lot.id }}" class="form-label">Location</label>
                <textarea class="form-control" id="location{{ lot.id }}" name="address"
                  rows="3">{{ lot.address }}</textarea>
              </div>
              <div class="mb-3">
                <label for="PinCode{{ lot.id }}" class="form-label">Pin Code</label>
                <input type="number" class="form-control" id="PinCode{{ lot.id }}" name="pincode"
                  value="{{ lot.pincode }}" min="1" required>
              </div>
              <div class="mb-3">
                <label for="Price{{ lot.id }}" class="form-label">Price(per hour)</label>
                <input type="number" class="form-control" id="Price{{ lot.id }}" name="price"
                  value="{{ lot.price_per_hour }}" min="1" required>
              </div>
              <div class="mb-3">
                <label for="MaxSpots{{ lot.id }}" class="form-label">Total Spots</label>
                <input type="number" class="form-control" id="MaxSpots{{ lot.id }}" name="maxspots"
                  value="{{ lot.max_spots }}" min="1" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">Update Lot</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Spot View/Delete Modal for each spot in this lot -->
    {% for spot in lot.spots %}
    <div class="modal fade" id="ViewDeleteSpotModal{{ spot.id }}" tabindex="-1"
      aria-labelledby="ViewDeleteSpotModalLabel{{ spot.id }}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="ViewDeleteSpotModalLabel{{ spot.id }}">Parking Spot {{ spot.id }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>Spot ID : </strong> {{ spot.id }}</p>
            {% if spot.status == 'A' %}
            <p><strong>Status : </strong><button class="btn btn-success">{{ spot.status }}</button></p>
            {% else %}
            <p><strong>Status : </strong><button data-bs-toggle="modal"
                data-bs-target="#ViewOccupiedSpotModal{{spot.id}}" class="btn btn-warning">{{ spot.status }}</button>
            </p>
            {% endif %}
            <!-- Add more spot details if needed -->
          </div>
          <div class="modal-footer">
            <form action="{{ url_for('delete_parking_spot', spot_id=spot.id) }}" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-danger"
                onclick="return confirm('Are you sure you want to delete this spot?')">Delete Spot</button>
            </form>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Occupied Spot Detail Modal -->
    <div class="modal fade" id="ViewOccupiedSpotModal{{ spot.id }}" tabindex="-1"
      aria-labelledby="ViewOccupiedSpotModalLabel{{ spot.id }}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="ViewOccupiedSpotModalLabel{{ spot.id }}">Occupied Spot Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>Spot ID : </strong> {{ spot.reservation.spot_id }}</p>
            <p><strong>Customer ID : </strong> {{ spot.reservation.user_id }}</p>
            <p><strong>Vehicle No : </strong> {{ spot.reservation.user_id }}</p>
            <p><strong>Date/Time of Parking : </strong> {{ spot.reservation.start_time }}</p>
            <p><strong>Date/Time of Releasing : </strong> {{ spot.reservation.end_time }}</p>
            <p><strong>Est. Parking Cost : </strong> {% if spot.reservation %}
              {{ spot.reservation.estimated_cost() }}
              {% else %}
              N/A
              {% endif %}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  {% endfor %}
  </div>
</div>