<form class="row justify-content-center mt-4" method="GET" action="/search_parking">
    <div class="col-md-6">
        <input type="text" class="form-control text-center px-4 py-2 rounded-pill border-2 border-primary shadow"
            placeholder="ðŸ” Search Parking by Area Name / Pincode" name="search_query">
    </div>
</form>
<div class="container-fluid mt-4">
    {% if context['search_query'] %}
    <h2 class="text-center fw-bold text-gradient mb-4">Parking Lot @ {{ context['search_query'] }}</h2>
    {% else %}
    <h2 class="text-center fw-bold text-gradient mb-4">Available Parking Lots</h2>
    {% endif %}
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body">
                    <table class="table table-bordered table-hover align-middle rounded-3 overflow-hidden">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Location</th>
                                <th scope="col">Availability</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lot in context['lots'] %}
                            <tr>
                                <td>{{ lot.id }}</td>
                                <td>{{ lot.address }}</td>
                                <td>
                                    {% if lot.available_spots() > 0 %}
                                        <span class="badge bg-success">{{ lot.available_spots() }} Available</span>
                                    {% else %}
                                        <span class="badge bg-danger">Full</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-primary rounded-pill" data-bs-toggle="modal"
                                        data-bs-target="#BookSpotModal{{ lot.id }}">
                                        <i class="fas fa-parking me-1"></i>Book
                                    </button>
                                </td>
                            </tr>
                            <div class="modal fade" id="BookSpotModal{{ lot.id }}" tabindex="-1"
                                aria-labelledby="BookSpotModalLabel{{ lot.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content rounded-4">
                                        <form method="POST" action="{{ url_for('book_spot', lot_id=lot.id) }}">
                                            <div class="modal-header bg-primary text-white rounded-top-4">
                                                <h5 class="modal-title" id="BookSpotModalLabel{{ lot.id }}">
                                                    <i class="fas fa-ticket-alt me-2"></i>Book Parking Spot
                                                </h5>
                                                <button type="button" class="btn-close btn-close-white"
                                                    data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="mb-3">
                                                    <label for="lotName{{ lot.id }}" class="form-label">Lot Id</label>
                                                    <input type="text" class="form-control" id="lotName{{ lot.id }}"
                                                        name="lotname" value="{{ lot.id }}" readonly>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="spotId{{ lot.id }}" class="form-label">Spot Id</label>
                                                    <input type="text" class="form-control" id="spotId{{ lot.id }}"
                                                        name="spot_id" value="{{ lot.get_available_spot().id }}" readonly>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="location{{ lot.id }}" class="form-label">Location</label>
                                                    <textarea class="form-control" id="location{{ lot.id }}" name="address"
                                                        rows="2" readonly>{{ lot.address }}</textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="VehicleNo{{ lot.id }}" class="form-label">Vehicle No.</label>
                                                    <input type="text" class="form-control border border-secondary"
                                                        id="VehicleNo{{ lot.id }}" name="vehicle_number" placeholder="xxxxxx"
                                                        min="1" required>
                                                </div>
                                            </div>
                                            <div class="modal-footer rounded-bottom-4">
                                                <button type="button" class="btn btn-outline-secondary"
                                                    data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-success">
                                                    <i class="fas fa-check me-1"></i>Reserve
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
.text-gradient {
    background: linear-gradient(90deg, #007bff 60%, #00c6ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
</style>